<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„: ØªØ¹Ù„Ù… Ø§Ù„Ø¬Ù…Ø¹ - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ù†Ù‚Ø§Ø· */
        .progress-container { background: white; padding: 20px; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .step { width: 40px; height: 40px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; }
        .step.active { background: #667eea; color: white; transform: scale(1.1); }
        .points-display { background: linear-gradient(135deg, #FFD700, #FFA500); padding: 10px 20px; border-radius: 25px; color: white; font-weight: bold; display: flex; align-items: center; gap: 10px; }

        /* Ù‚Ø³Ù… Ø§Ù„Ø´Ø±Ø­ Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡ */
        .addition-section { background: linear-gradient(135deg, #FF6B6B, #FF8E8E); color: white; padding: 40px; border-radius: 20px; margin: 30px; text-align: center; }
        .fruit-basket { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 30px 0; font-size: 50px; }
        
        /* Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª (Ø§Ù„Ù…Ø·ÙˆØ±Ø© Ù„Ù„Ù†Ù‚Ø§Ù„) */
        .interactive-game { background: #FFF9C4; padding: 40px; border-radius: 20px; margin: 30px; border: 3px dashed #FFD54F; text-align: center; }
        .drag-item { 
            width: 80px; height: 80px; background: #4CAF50; color: white; border-radius: 15px; 
            display: flex; align-items: center; justify-content: center; font-size: 32px; 
            font-weight: bold; cursor: grab; touch-action: none; position: relative; z-index: 100;
        }
        .drop-zone { 
            width: 100px; height: 100px; border: 3px dashed #2196F3; border-radius: 15px; 
            background: white; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #2196F3;
        }
        .drop-zone.filled { background: #d4edda; border: 3px solid #4CAF50; color: #333; font-size: 32px; font-weight: bold; }

        /* ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª */
        .exercise-card { background: white; padding: 25px; border-radius: 15px; margin: 20px 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .animal-display { font-size: 45px; margin: 15px 0; letter-spacing: 10px; }
        .option-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .option-btn { padding: 15px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; font-size: 20px; font-weight: bold; }

        /* Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© */
        .cert-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .cert-content { background: white; padding: 40px; border-radius: 20px; text-align: center; border: 12px double #FFD700; max-width: 500px; }
        
        .math-btn { padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-container">
        <div class="progress-steps">
            <div class="step active">1</div>
            <div class="step active">2</div>
            <div class="step">3</div>
        </div>
        <div class="points-display"><i class="fas fa-star"></i> Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
        <button onclick="window.location.href='index.html'" class="math-btn" style="background:#333"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <div class="addition-section">
        <h2><i class="fas fa-apple-alt"></i> Ù‡ÙŠØ§ Ù†ØªØ¹Ù„Ù… Ø§Ù„Ø¬Ù…Ø¹ Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡</h2>
        <p>Ø§Ù„Ø¬Ù…Ø¹ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ù†Ø¶Ø¹ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ù…Ø¹Ø§Ù‹</p>
        
        <div class="fruit-basket">
            <span>ğŸ</span> <span>+</span> <span>ğŸŠ</span> <span>=</span> <span>ğŸğŸŠ</span>
        </div>
        <p>1 ØªÙØ§Ø­Ø© + 1 Ø¨Ø±ØªÙ‚Ø§Ù„Ø© = Ù‚Ø·Ø¹ØªØ§Ù† Ù…Ù† Ø§Ù„ÙØ§ÙƒÙ‡Ø©</p>
    </div>

    <div class="interactive-game">
        <h3><i class="fas fa-gamepad"></i> Ø§Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„ØªØ¬Ù…Ø¹ Ø§Ù„ÙÙˆØ§ÙƒÙ‡</h3>
        <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
            <div class="drag-item" data-val="3" onmousedown="dragS(event)" ontouchstart="dragS(event)">ğŸ 3</div>
            <div class="drag-item" data-val="2" onmousedown="dragS(event)" ontouchstart="dragS(event)">ğŸŠ 2</div>
        </div>
        
        <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
            <div class="drop-zone" id="z1">ØŸ</div>
            <span style="font-size: 30px;">+</span>
            <div class="drop-zone" id="z2">ØŸ</div>
            <span style="font-size: 30px;">=</span>
            <input type="number" id="ans" style="width: 80px; height: 80px; font-size: 30px; text-align: center; border-radius: 15px; border: 3px solid #4CAF50;">
        </div>
        <button onclick="checkG()" class="math-btn" style="background:#667eea; margin-top: 20px; width: 200px;">ØªØ­Ù‚Ù‚ âœ…</button>
    </div>
 <!-- ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ -->
        <div class="exercise">
            <h3 class="exercise-title">
                <i class="fas fa-pencil-alt"></i> ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨
            </h3>
            
            <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ -->
            <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ 1: Ù…Ø§ Ù†Ø§ØªØ¬ Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„ØªØ§Ù„ÙŠØŸ</h4>
                <div style="font-size: 36px; text-align: center; margin: 20px 0;">
                    4 ğŸ + 2 ğŸŠ = ?
                </div>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkExerciseAnswer(1, 5)">5</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(1, 6)">6</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(1, 7)">7</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(1, 8)">8</button>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
            <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ 2: Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</h4>
                <div style="font-size: 36px; text-align: center; margin: 20px 0;">
                    3 + 1 = ?
                </div>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkExerciseAnswer(2, 3)">3</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(2, 4)">4</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(2, 5)">5</button>
                    <button class="option-btn" onclick="checkExerciseAnswer(2, 2)">2</button>
                </div>
            </div>
       
    <div class="exercise-card">
        <h3>ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØŸ ğŸ¶ğŸ±</h3>
        
        <div class="animal-display">ğŸ¶ğŸ¶ğŸ¶ + ğŸ±ğŸ±</div>
        <div class="option-grid">
            <button class="option-btn" onclick="checkEx(this, 5)">5</button>
            <button class="option-btn" onclick="checkEx(this, 4)">4</button>
            <button class="option-btn" onclick="checkEx(this, 6)">6</button>
            <button class="option-btn" onclick="checkEx(this, 3)">3</button>
        </div>
    </div>

    <div style="text-align: center; padding: 30px;">
        <button onclick="showCert()" class="math-btn" style="background:#FF9800; font-size: 20px;">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ğŸ“</button>
    </div>
</div>

<div id="certModal" class="cert-modal">
    <div class="cert-content">
        <h1 style="color:#FFD700">Ø´Ù‡Ø§Ø¯Ø© ØªÙÙˆÙ‚ ğŸŒŸ</h1>
        <p>Ù†Ù‡Ù†Ø¦Ùƒ ÙŠØ§ Ø¨Ø·Ù„ Ø¹Ù„Ù‰ Ø¥ØªÙ…Ø§Ù… Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù…Ø¹</p>
        <h2 style="margin: 20px 0;">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="fScore">0</span></h2>
        <button onclick="location.reload()" class="math-btn" style="background:#4CAF50">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    let score = 0;
    let activeItem = null;

    // Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø³Ø­Ø¨ (Ù„Ø§Ø¨ØªÙˆØ¨ + Ù†Ù‚Ø§Ù„)
    function dragS(e) {
        activeItem = e.target;
        activeItem.style.position = 'fixed';
        activeItem.style.zIndex = '1000';
        mMove(e);
        document.addEventListener('mousemove', onM);
        document.addEventListener('mouseup', onE);
        document.addEventListener('touchmove', onT, {passive: false});
        document.addEventListener('touchend', onE);
    }

    function mMove(e) {
        let x = e.clientX || e.touches[0].clientX;
        let y = e.clientY || e.touches[0].clientY;
        activeItem.style.left = (x - 40) + 'px';
        activeItem.style.top = (y - 40) + 'px';
    }

    function onM(e) { mMove(e); }
    function onT(e) { e.preventDefault(); mMove(e); }

    function onE(e) {
        let x = e.clientX || e.changedTouches[0].clientX;
        let y = e.clientY || e.changedTouches[0].clientY;
        activeItem.style.display = 'none';
        let target = document.elementFromPoint(x, y);
        activeItem.style.display = 'flex';

        if(target && target.classList.contains('drop-zone')) {
            target.innerHTML = activeItem.getAttribute('data-val');
            target.classList.add('filled');
            activeItem.style.visibility = 'hidden';
            updateScore(10);
        } else {
            activeItem.style.position = 'relative';
            activeItem.style.left = '0'; activeItem.style.top = '0';
        }
        document.removeEventListener('mousemove', onM);
        document.removeEventListener('mouseup', onE);
        document.removeEventListener('touchmove', onT);
        document.removeEventListener('touchend', onE);
    }

    function checkG() {
        let v1 = parseInt(document.getElementById('z1').innerText);
        let v2 = parseInt(document.getElementById('z2').innerText);
        let res = parseInt(document.getElementById('ans').value);
        if(v1 + v2 === res) { alert("Ø±Ø§Ø¦Ø¹! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©"); updateScore(20); }
        else { alert("Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©"); }
    }

    function checkEx(btn, val) {
        if(val === 5) { btn.style.background = "#4CAF50"; btn.style.color="white"; updateScore(20); }
        else { btn.style.background = "#f44336"; btn.style.color="white"; }
    }

    function updateScore(v) {
        score += v;
        document.getElementById('score').innerText = score;
    }

    function showCert() {
        document.getElementById('fScore').innerText = score;
        document.getElementById('certModal').style.display = 'flex';
    }
</script>
 <script>
    // ====== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ======
    let sessionPoints = 0; // Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
    let totalPoints = 0; // Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ© (Ù…Ø­ÙÙˆØ¸Ø©)
    let completedExercises = 0;
    let gamePoints = 0;
    let exercisePoints = 0;
    let draggedElement = null;

    // Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹
    let currentNum1 = 2;
    let currentNum2 = 3;
    let currentEmoji1 = "ğŸ";
    let currentEmoji2 = "ğŸŠ";

    // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†
    const emojiOptions = [
        { emoji: "ğŸ", name: "ØªÙØ§Ø­Ø©", color: "#FF5252" },
        { emoji: "ğŸŠ", name: "Ø¨Ø±ØªÙ‚Ø§Ù„Ø©", color: "#FF9800" },
        { emoji: "ğŸŒ", name: "Ù…ÙˆØ²Ø©", color: "#FFEB3B" },
        { emoji: "ğŸ‡", name: "Ø¹Ù†Ø¨", color: "#9C27B0" },
        { emoji: "ğŸ“", name: "ÙØ±Ø§ÙˆÙ„Ø©", color: "#F44336" },
        { emoji: "ğŸ", name: "ÙƒÙ…Ø«Ø±Ù‰", color: "#8BC34A" },
        { emoji: "ğŸ‘", name: "Ø®ÙˆØ®", color: "#FFCCBC" },
        { emoji: "ğŸ’", name: "ÙƒØ±Ø²", color: "#E91E63" },
        { emoji: "ğŸ¥", name: "ÙƒÙŠÙˆÙŠ", color: "#8BC34A" },
        { emoji: "ğŸ‰", name: "Ø¨Ø·ÙŠØ®", color: "#FF5722" }
    ];

    // Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†
    const exerciseAnswers = {
        1: 6,
        2: 4,
        3: 5
    };

    let answeredExercises = new Set();

    // ====== Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ======
    function updatePoints(pointsToAdd, source = 'game') {
        sessionPoints += pointsToAdd;
        totalPoints += pointsToAdd;
        
        if (source === 'game') {
            gamePoints += pointsToAdd;
        } else {
            exercisePoints += pointsToAdd;
            completedExercises++;
        }
        
        updateDisplay();
        savePoints();
    }

    function updateDisplay() {
        document.getElementById('points').textContent = sessionPoints;
        document.getElementById('totalPoints').textContent = sessionPoints;
        updateStars();
    }

    function updateStars() {
        const stars = document.querySelectorAll('#starsContainer .star');
        const starCount = Math.min(Math.floor(sessionPoints / 20), 5);
        
        stars.forEach((star, index) => {
            if (index < starCount) {
                star.innerHTML = 'â˜…';
                star.classList.remove('empty');
                star.style.color = '#FFD700';
                star.style.textShadow = '0 0 10px #FFD700';
            } else {
                star.innerHTML = 'â˜†';
                star.classList.add('empty');
                star.style.color = '#e0e0e0';
                star.style.textShadow = 'none';
            }
        });
    }

    function savePoints() {
        localStorage.setItem('math_addition_total_points', totalPoints);
        localStorage.setItem('math_addition_session_points', sessionPoints);
        localStorage.setItem('math_addition_completed_exercises', completedExercises);
    }

    function loadPoints() {
        const savedTotal = localStorage.getItem('math_addition_total_points');
        const savedSession = localStorage.getItem('math_addition_session_points');
        const savedExercises = localStorage.getItem('math_addition_completed_exercises');
        
        if (savedTotal) totalPoints = parseInt(savedTotal);
        sessionPoints = 0;
        if (savedExercises) completedExercises = parseInt(savedExercises);
        
        updateDisplay();
        
        if (savedTotal && parseInt(savedTotal) > 0) {
            setTimeout(() => {
                showTemporaryMessage(`ğŸ“Š Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©: ${savedTotal} Ù†Ù‚Ø·Ø©`, 'info');
            }, 1000);
        }
    }

    // ====== Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹ ======
    function generateRandomNumbers() {
        currentNum1 = Math.floor(Math.random() * 5) + 1;
        currentNum2 = Math.floor(Math.random() * 5) + 1;
        
        while (currentNum1 + currentNum2 > 10) {
            currentNum1 = Math.floor(Math.random() * 5) + 1;
            currentNum2 = Math.floor(Math.random() * 5) + 1;
        }
        
        const randomIndex1 = Math.floor(Math.random() * emojiOptions.length);
        const randomIndex2 = Math.floor(Math.random() * emojiOptions.length);
        currentEmoji1 = emojiOptions[randomIndex1].emoji;
        currentEmoji2 = emojiOptions[randomIndex2].emoji;
    }

    function updateDraggableItems() {
        const dragItem1 = document.getElementById('dragItem1');
        const dragItem2 = document.getElementById('dragItem2');
        
        dragItem1.innerHTML = `${currentEmoji1} ${currentNum1}`;
        dragItem1.setAttribute('data-value', currentNum1);
        dragItem1.setAttribute('data-emoji', currentEmoji1);
        dragItem1.style.backgroundColor = emojiOptions.find(e => e.emoji === currentEmoji1)?.color || '#FF5252';
        
        dragItem2.innerHTML = `${currentEmoji2} ${currentNum2}`;
        dragItem2.setAttribute('data-value', currentNum2);
        dragItem2.setAttribute('data-emoji', currentEmoji2);
        dragItem2.style.backgroundColor = emojiOptions.find(e => e.emoji === currentEmoji2)?.color || '#FF9800';
        
        dragItem1.style.display = 'flex';
        dragItem2.style.display = 'flex';
        
        reinitializeDragEvents();
    }

    function resetGame() {
        document.getElementById('dropZone1').innerHTML = '? Ù‡Ù†Ø§';
        document.getElementById('dropZone1').removeAttribute('data-value');
        document.getElementById('dropZone1').removeAttribute('data-filled');
        document.getElementById('dropZone1').removeAttribute('data-emoji');
        document.getElementById('dropZone1').style.backgroundColor = '';
        document.getElementById('dropZone1').style.borderStyle = 'dashed';
        document.getElementById('dropZone1').style.borderColor = '#2196F3';
        document.getElementById('dropZone1').classList.remove('drag-over');
        
        document.getElementById('dropZone2').innerHTML = '? ÙˆÙ‡Ù†Ø§';
        document.getElementById('dropZone2').removeAttribute('data-value');
        document.getElementById('dropZone2').removeAttribute('data-filled');
        document.getElementById('dropZone2').removeAttribute('data-emoji');
        document.getElementById('dropZone2').style.backgroundColor = '';
        document.getElementById('dropZone2').style.borderStyle = 'dashed';
        document.getElementById('dropZone2').style.borderColor = '#2196F3';
        document.getElementById('dropZone2').classList.remove('drag-over');
        
        document.getElementById('userResult').value = '';
        document.getElementById('userResult').style.borderColor = '#4CAF50';
        document.getElementById('userResult').style.boxShadow = 'none';
        document.getElementById('gameResult').style.display = 'none';
        
        reinitializeDropEvents();
    }

    function generateNewExercise() {
        generateRandomNumbers();
        updateDraggableItems();
        resetGame();
        
        document.getElementById('currentNumbers').textContent = `${currentNum1} + ${currentNum2}`;
        document.getElementById('exerciseInfo').style.display = 'block';
        showTemporaryMessage(`ğŸ® ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯: ${currentNum1} + ${currentNum2}`, 'correct');
        document.getElementById('userResult').focus();
    }

    function checkAdditionGame() {
        const zone1 = document.getElementById('dropZone1');
        const zone2 = document.getElementById('dropZone2');
        const userInput = document.getElementById('userResult');
        const resultDiv = document.getElementById('gameResult');
        
        if (!zone1.hasAttribute('data-filled') || !zone2.hasAttribute('data-filled')) {
            showTemporaryMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù†ØµØ±ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!', 'incorrect');
            
            if (!zone1.hasAttribute('data-filled')) {
                zone1.style.animation = 'shake 0.5s';
                setTimeout(() => zone1.style.animation = '', 500);
            }
            if (!zone2.hasAttribute('data-filled')) {
                zone2.style.animation = 'shake 0.5s';
                setTimeout(() => zone2.style.animation = '', 500);
            }
            return;
        }
        
        if (!userInput.value || isNaN(userInput.value)) {
            showTemporaryMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø§ØªØ¬ Ø§Ù„Ø¬Ù…Ø¹!', 'incorrect');
            userInput.style.animation = 'shake 0.5s';
            setTimeout(() => userInput.style.animation = '', 500);
            userInput.focus();
            return;
        }
        
        const num1 = parseInt(zone1.getAttribute('data-value'));
        const num2 = parseInt(zone2.getAttribute('data-value'));
        const correctResult = num1 + num2;
        const userResult = parseInt(userInput.value);
        
        let resultHTML = '';
        
        if (userResult === correctResult) {
            resultHTML = `
                <div class="feedback-message feedback-correct">
                    <h4><i class="fas fa-trophy"></i> Ø£Ø­Ø³Ù†Øª!</h4>
                    <p>${num1} + ${num2} = ${correctResult}</p>
                    <p style="font-size: 18px; margin-top: 10px;">
                        <i class="fas fa-coins" style="color: #FFD700;"></i>
                        Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª <strong>20 Ù†Ù‚Ø·Ø©</strong>!
                    </p>
                </div>
            `;
            
            zone1.classList.add('correct-drop');
            zone2.classList.add('correct-drop');
            userInput.style.borderColor = '#4CAF50';
            userInput.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            
            updatePoints(20, 'game');
            
            setTimeout(() => generateNewExercise(), 3000);
            
        } else {
            resultHTML = `
                <div class="feedback-message feedback-incorrect">
                    <h4><i class="fas fa-exclamation-triangle"></i> Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</h4>
                    <p>Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ùˆ: ${num1} + ${num2} = ${correctResult}</p>
                    <p style="margin-top: 10px;">
                        <button onclick="showHint(${num1}, ${num2})" class="math-btn" style="padding: 5px 15px; font-size: 12px;">
                            <i class="fas fa-lightbulb"></i> Ø¹Ø±Ø¶ ØªÙ„Ù…ÙŠØ­
                        </button>
                    </p>
                </div>
            `;
            
            userInput.style.animation = 'shake 0.5s';
            userInput.style.borderColor = '#f44336';
            userInput.style.boxShadow = '0 0 10px rgba(244, 67, 54, 0.3)';
            setTimeout(() => userInput.style.animation = '', 500);
        }
        
        resultDiv.innerHTML = resultHTML;
        resultDiv.style.display = 'block';
        
        if (userResult !== correctResult) {
            resultDiv.style.animation = 'shake 0.5s';
            setTimeout(() => resultDiv.style.animation = '', 500);
        }
    }

    // ====== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª ======
    function initializeDragAndDrop() {
        const dragItems = document.querySelectorAll('.drag-item');
        const dropZones = document.querySelectorAll('.drop-zone');
        
        dragItems.forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
        });
        
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });
    }

    function reinitializeDragEvents() {
        const dragItems = document.querySelectorAll('.drag-item');
        dragItems.forEach(item => {
            item.removeEventListener('dragstart', handleDragStart);
            item.removeEventListener('dragend', handleDragEnd);
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
        });
    }

    function reinitializeDropEvents() {
        const dropZones = document.querySelectorAll('.drop-zone');
        dropZones.forEach(zone => {
            zone.removeEventListener('dragover', handleDragOver);
            zone.removeEventListener('dragenter', handleDragEnter);
            zone.removeEventListener('dragleave', handleDragLeave);
            zone.removeEventListener('drop', handleDrop);
            zone.removeEventListener('dblclick', removeFromDropZone);
            
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });
    }

    function handleDragStart(e) {
        draggedElement = this;
        this.style.opacity = '0.4';
        this.style.transform = 'scale(0.9)';
        this.classList.add('dragging');
        
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
        e.dataTransfer.setData('text/plain', this.getAttribute('data-value'));
    }

    function handleDragEnd() {
        this.style.opacity = '1';
        this.style.transform = 'scale(1)';
        this.classList.remove('dragging');
        draggedElement = null;
        
        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.classList.remove('drag-over');
            zone.style.backgroundColor = '';
            zone.style.borderStyle = 'dashed';
        });
    }

    function handleDragOver(e) {
        e.preventDefault();
        return false;
    }

    function handleDragEnter(e) {
        e.preventDefault();
        if (!this.hasAttribute('data-filled')) {
            this.classList.add('drag-over');
            this.style.backgroundColor = '#e3f2fd';
            this.style.borderStyle = 'solid';
            this.style.borderColor = '#2196F3';
        }
    }

    function handleDragLeave() {
        if (!this.hasAttribute('data-filled')) {
            this.classList.remove('drag-over');
            this.style.backgroundColor = '';
            this.style.borderStyle = 'dashed';
            this.style.borderColor = '#2196F3';
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        
        if (this.hasAttribute('data-filled')) return;
        
        this.classList.remove('drag-over');
        this.style.backgroundColor = '';
        
        const value = e.dataTransfer.getData('text/plain');
        const html = e.dataTransfer.getData('text/html');
        const emoji = html.split(' ')[0];
        
        this.innerHTML = html;
        this.setAttribute('data-value', value);
        this.setAttribute('data-filled', 'true');
        this.setAttribute('data-emoji', emoji);
        this.style.backgroundColor = '#d4edda';
        this.style.borderStyle = 'solid';
        this.style.borderColor = '#4CAF50';
        
        if (draggedElement) draggedElement.style.display = 'none';
        draggedElement = null;
        this.addEventListener('dblclick', removeFromDropZone);
    }

    function removeFromDropZone() {
        const value = this.getAttribute('data-value');
        const emoji = this.getAttribute('data-emoji');
        
        document.querySelectorAll('.drag-item').forEach(item => {
            const itemValue = item.getAttribute('data-value');
            const itemEmoji = item.innerHTML.split(' ')[0];
            
            if (itemValue === value && itemEmoji === emoji && item.style.display === 'none') {
                item.style.display = 'flex';
                item.style.animation = 'popIn 0.3s';
            }
        });
        
        this.innerHTML = this.id === 'dropZone1' ? '? Ù‡Ù†Ø§' : '? ÙˆÙ‡Ù†Ø§';
        this.removeAttribute('data-value');
        this.removeAttribute('data-filled');
        this.removeAttribute('data-emoji');
        this.style.backgroundColor = '';
        this.style.borderStyle = 'dashed';
        this.style.borderColor = '#2196F3';
        this.removeEventListener('dblclick', removeFromDropZone);
    }

    // ====== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ======
    function clearAll() {
        document.querySelectorAll('.drop-zone').forEach(zone => {
            if (zone.hasAttribute('data-filled')) {
                const dblClickEvent = new Event('dblclick');
                zone.dispatchEvent(dblClickEvent);
            }
            
            zone.innerHTML = zone.id === 'dropZone1' ? '? Ù‡Ù†Ø§' : '? ÙˆÙ‡Ù†Ø§';
            zone.removeAttribute('data-value');
            zone.removeAttribute('data-filled');
            zone.removeAttribute('data-emoji');
            zone.style.backgroundColor = '';
            zone.style.borderStyle = 'dashed';
            zone.style.borderColor = '#2196F3';
            zone.classList.remove('drag-over');
            zone.removeEventListener('dblclick', removeFromDropZone);
        });
        
        document.querySelectorAll('.drag-item').forEach(item => {
            item.style.display = 'flex';
            item.style.animation = 'popIn 0.3s';
        });
        
        document.getElementById('userResult').value = '';
        document.getElementById('userResult').style.borderColor = '#4CAF50';
        document.getElementById('userResult').style.boxShadow = 'none';
        document.getElementById('gameResult').style.display = 'none';
        
        showTemporaryMessage('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±', 'info');
    }

    function showHint(num1, num2) {
        const hintHTML = `
            <div class="feedback-message" style="background: #FFF3CD; border-color: #FFEAA7; color: #856404;">
                <h4><i class="fas fa-lightbulb"></i> ØªÙ„Ù…ÙŠØ­ Ù…ÙÙŠØ¯:</h4>
                <p>Ù„Ø­Ø³Ø§Ø¨ ${num1} + ${num2}:</p>
                <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0; font-size: 24px;">
                    <div style="display: flex;">
                        ${Array(num1).fill().map(() => 'ğŸ').join('')}
                    </div>
                    <div style="margin: 0 10px;">+</div>
                    <div style="display: flex;">
                        ${Array(num2).fill().map(() => 'ğŸŠ').join('')}
                    </div>
                    <div style="margin: 0 10px;">=</div>
                    <div style="display: flex;">
                        ${Array(num1 + num2).fill().map(() => 'ğŸ‡').join('')}
                    </div>
                </div>
                <p>Ø¹Ø¯ ÙƒÙ„ Ø§Ù„ÙÙˆØ§ÙƒØ© Ù…Ø¹Ø§Ù‹: ${num1} + ${num2} = ${num1 + num2}</p>
            </div>
        `;
        
        showTemporaryMessage(hintHTML, 'info');
    }

    // ====== Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† ======
    function checkExerciseAnswer(questionNumber, selectedAnswer) {
        if (answeredExercises.has(questionNumber)) {
            showTemporaryMessage('Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!', 'info');
            return;
        }
        
        const isCorrect = selectedAnswer === exerciseAnswers[questionNumber];
        const buttons = event.target.parentElement.querySelectorAll('.option-btn');
        
        buttons.forEach(btn => btn.classList.remove('selected'));
        event.target.classList.add('selected');
        
        const feedback = document.createElement('div');
        feedback.className = `feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
        feedback.innerHTML = `
            <h4>${isCorrect ? 'ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©' : 'ğŸ˜… Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'}</h4>
            <p>${isCorrect ? 'Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª 10 Ù†Ù‚Ø§Ø·!' : 'Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ùˆ: ' + exerciseAnswers[questionNumber]}</p>
        `;
        
        const questionDiv = event.target.closest('.exercise > div');
        const existingFeedback = questionDiv.querySelector('.feedback-message');
        if (existingFeedback) existingFeedback.remove();
        questionDiv.appendChild(feedback);
        
        setTimeout(() => {
            if (feedback.parentNode) {
                feedback.style.opacity = '0';
                feedback.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (feedback.parentNode) feedback.remove();
                }, 500);
            }
        }, 3000);
        
        if (isCorrect) {
            updatePoints(10, 'exercise');
            answeredExercises.add(questionNumber);
        }
    }

    // ====== Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ======
    function showCertificate() {
        const today = new Date();
        const dateStr = today.toLocaleDateString('ar-SA', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        document.getElementById('certificateDate').textContent = dateStr;
        const stars = Math.min(Math.floor(sessionPoints / 20), 5);
        document.getElementById('certificateStars').textContent = stars;
        document.getElementById('certificatePoints').textContent = sessionPoints + ' Ù†Ù‚Ø·Ø©';
        
        const modal = document.getElementById('certificateModal');
        modal.style.display = 'block';
        modal.style.animation = 'fadeIn 0.3s ease-out';
        document.body.style.overflow = 'hidden';
    }

    function closeCertificate() {
        const modal = document.getElementById('certificateModal');
        modal.style.animation = 'fadeOut 0.3s ease-in';
        
        setTimeout(() => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }, 300);
    }

    function printCertificateNow() {
        const stars = Math.min(Math.floor(sessionPoints / 20), 5);
        const certificateHTML = `
            <!DOCTYPE html>
            <html dir="rtl" lang="ar">
            <head>
                <meta charset="UTF-8">
                <title>Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² - Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù…Ø¹</title>
                <style>
                    @media print { @page { margin: 20mm; } body { margin: 0; padding: 0; } }
                    body { font-family: 'Arial', sans-serif; text-align: center; padding: 20px; }
                    .certificate { max-width: 800px; margin: 0 auto; padding: 40px; border: 20px solid #FFD700; border-radius: 20px; }
                    .header { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; padding: 30px; margin: -40px -40px 30px -40px; border-radius: 0 0 20px 20px; }
                    .trophy { font-size: 80px; color: #FFD700; margin: 20px 0; }
                </style>
            </head>
            <body>
                <div class="certificate">
                    <div class="header">
                        <h1 style="margin: 0; font-size: 32px;">Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</h1>
                        <p style="margin: 5px 0 0 0; font-size: 18px;">ÙÙŠ Ø¯Ø±Ø³ ØªØ¹Ù„Ù… Ø§Ù„Ø¬Ù…Ø¹</p>
                    </div>
                    
                    <div class="trophy"><i class="fas fa-trophy"></i></div>
                    
                    <h2 style="color: #333;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
                    <p style="font-size: 18px; color: #666;">
                        Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¨Ù†Ø¬Ø§Ø­ <strong style="color: #FF6B6B;">Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù…Ø¹</strong><br>
                        ÙˆØ£Ø¸Ù‡Ø±Øª ØªÙÙˆÙ‚Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹
                    </p>
                    
                    <div style="margin: 30px 0; text-align: right;">
                        <p><strong>Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> _______________</p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</strong> ${document.getElementById('certificateDate').textContent}</p>
                        <p><strong>Ø§Ù„Ø¯Ø±Ø¬Ø©:</strong> ${stars}/5 Ù†Ø¬ÙˆÙ… â­</p>
                        <p><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${sessionPoints} Ù†Ù‚Ø·Ø©</p>
                    </div>
                    
                    <div style="color: #666; font-size: 14px; margin-top: 30px;">
                        <p>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ¹Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</p>
                        <p style="color: #999;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-SA')}</p>
                    </div>
                </div>
                
                <script>
                    window.onload = function() {
                        window.print();
                        setTimeout(function() {
                            window.close();
                        }, 1000);
                    }
                <\/script>
            </body>
            </html>
        `;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(certificateHTML);
        printWindow.document.close();
    }

    function shareCertificate() {
        const shareText = `ğŸ‰ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø² ÙÙŠ Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù…Ø¹!
Ø§Ù„Ù†Ø¬ÙˆÙ…: ${Math.min(Math.floor(sessionPoints / 20), 5)}/5 â­
Ø§Ù„Ù†Ù‚Ø§Ø·: ${sessionPoints}
ØªÙ‡Ø§Ù†ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙÙˆÙ‚!`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø² - Ø¯Ø±Ø³ Ø§Ù„Ø¬Ù…Ø¹',
                text: shareText,
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(shareText)
                .then(() => showTemporaryMessage('âœ“ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©', 'correct'))
                .catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = shareText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showTemporaryMessage('âœ“ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©', 'correct');
                });
        }
    }

    function showTemporaryMessage(message, type) {
        const existingMessage = document.querySelector('.temp-message');
        if (existingMessage) existingMessage.remove();
        
        const tempDiv = document.createElement('div');
        tempDiv.className = `temp-message feedback-message feedback-${type}`;
        tempDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-${type === 'correct' ? 'check-circle' : 
                                  type === 'incorrect' ? 'exclamation-circle' : 
                                  'info-circle'}"></i>
                <span>${message}</span>
            </div>
        `;
        
        tempDiv.style.position = 'fixed';
        tempDiv.style.top = '80px';
        tempDiv.style.left = '50%';
        tempDiv.style.transform = 'translateX(-50%)';
        tempDiv.style.zIndex = '1000';
        tempDiv.style.padding = '15px 25px';
        tempDiv.style.borderRadius = '10px';
        tempDiv.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        
        document.body.appendChild(tempDiv);
        
        setTimeout(() => {
            if (tempDiv.parentNode) {
                tempDiv.style.opacity = '0';
                tempDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (tempDiv.parentNode) tempDiv.remove();
                }, 500);
            }
        }, 3000);
    }

    // ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ======
    document.addEventListener('DOMContentLoaded', function() {
        loadPoints();
        generateRandomNumbers();
        updateDraggableItems();
        initializeDragAndDrop();
        
        document.getElementById('currentNumbers').textContent = `${currentNum1} + ${currentNum2}`;
        document.getElementById('exerciseInfo').style.display = 'block';
        
        document.getElementById('userResult').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkAdditionGame();
        });
        
        setTimeout(() => {
            document.getElementById('userResult').focus();
            showTemporaryMessage('ğŸ® Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù„Ø¹Ø¨! Ø§Ù„Ù†Ù‚Ø§Ø· ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ± ÙÙŠ ÙƒÙ„ Ø¬Ù„Ø³Ø©', 'correct');
        }, 500);
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.getElementById('certificateModal').addEventListener('click', function(e) {
        if (e.target === this) closeCertificate();
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø§Ù„Ø²Ø± ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.getElementById('certificateModal').style.display === 'block') {
            closeCertificate();
        }
    });
    </script>

</body>
</html>