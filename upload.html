<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus,
        input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        .upload-area:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }
        .upload-area.dragover {
            background: #e6e9ff;
            border-color: #4a5568;
        }
        .file-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: transform 0.3s;
            margin-top: 10px;
        }
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        .upload-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .server-info {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 10px;
            font-size: 14px;
        }
        .port-selector {
            margin-bottom: 20px;
        }
        .port-btn {
            padding: 8px 15px;
            margin: 0 5px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .port-btn.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¤ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª</h1>
        
        <div class="port-selector">
            <label>Ø§Ø®ØªØ± Ù…Ù†ÙØ° Ø§Ù„Ø³ÙŠØ±ÙØ±:</label><br>
            <button class="port-btn active" onclick="setPort(3000)">3000</button>
            <button class="port-btn" onclick="setPort(8000)">8000</button>
            <button class="port-btn" onclick="setPort(8080)">8080</button>
        </div>
        
        <div class="upload-area" id="dropArea">
            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
            <strong>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§</strong><br>
            <small>Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØªÙŠ</small>
            <input type="file" id="audioFile" accept="audio/*" style="display: none;">
        </div>
        
        <div id="fileInfo" class="file-info"></div>
        
        <div class="form-group">
            <label for="letter">Ø§Ù„Ø­Ø±Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="letter" placeholder="Ù…Ø«Ø§Ù„: Ø£">
        </div>
        
        <div class="form-group">
            <label for="fileName">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="fileName" placeholder="Ù…Ø«Ø§Ù„: ØµÙˆØª_Ø§Ù„Ø­Ø±Ù">
        </div>
        
        <button class="upload-btn" id="uploadBtn" onclick="uploadFile()">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ğŸš€</button>
        
        <div id="result" class="result"></div>
        
        <div class="server-info">
            <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±:</strong><br>
            <div id="currentPort">Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø­Ø§Ù„ÙŠ: 3000</div>
            <div id="serverStatus">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø²</div>
        </div>
    </div>
    
    <script>
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let currentPort = 3000;
    let selectedFile = null;
    
    // DOM elements
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('audioFile');
    const fileInfo = document.getElementById('fileInfo');
    const uploadBtn = document.getElementById('uploadBtn');
    const resultDiv = document.getElementById('result');
    const currentPortDiv = document.getElementById('currentPort');
    const serverStatusDiv = document.getElementById('serverStatus');
    
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ù†ÙØ°
    function setPort(port) {
        currentPort = port;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.querySelectorAll('.port-btn').forEach(btn => {
            btn.classList.remove('active');
            if (parseInt(btn.textContent) === port) {
                btn.classList.add('active');
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        currentPortDiv.textContent = `Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„Ø­Ø§Ù„ÙŠ: ${port}`;
        serverStatusDiv.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø²';
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        testConnection();
    }
    
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
    async function testConnection() {
        serverStatusDiv.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø©: ÙŠØ®ØªØ¨Ø± Ø§Ù„Ø§ØªØµØ§Ù„...';
        
        const urls = [
            `http://localhost:${currentPort}/upload_fixed.php`,
            `http://localhost:${currentPort}/upload.php`,
            `http://127.0.0.1:${currentPort}/upload_fixed.php`
        ];
        
        for (const url of urls) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) {
                    serverStatusDiv.innerHTML = `Ø§Ù„Ø­Ø§Ù„Ø©: <span style="color: green;">âœ… Ù…ØªØµÙ„ Ø¨Ù€ ${url}</span>`;
                    return url;
                }
            } catch (error) {
                console.log(`ÙØ´Ù„ ${url}:`, error.message);
            }
        }
        
        serverStatusDiv.innerHTML = `Ø§Ù„Ø­Ø§Ù„Ø©: <span style="color: red;">âŒ ØºÙŠØ± Ù…ØªØµÙ„</span>`;
        return null;
    }
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, () => {
            dropArea.classList.add('dragover');
        }, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, () => {
            dropArea.classList.remove('dragover');
        }, false);
    });
    
    dropArea.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect();
        }
    });
    
    dropArea.addEventListener('click', () => {
        fileInput.click();
    });
    
    fileInput.addEventListener('change', handleFileSelect);
    
    function handleFileSelect() {
        if (fileInput.files.length > 0) {
            selectedFile = fileInput.files[0];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            const allowedTypes = ['audio/mpeg', 'audio/wav', 'audio/ogg'];
            if (!allowedTypes.includes(selectedFile.type)) {
                showResult('error', 'âŒ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ³Ù…Ø­ ÙÙ‚Ø· Ø¨Ù€ MP3, WAV, OGG');
                selectedFile = null;
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¬Ù…
            const fileSizeMB = (selectedFile.size / (1024*1024)).toFixed(2);
            if (selectedFile.size > 5 * 1024 * 1024) {
                showResult('error', `âŒ Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (${fileSizeMB} MB). Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 5 MB`);
                selectedFile = null;
                return;
            }
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
            fileInfo.style.display = 'block';
            fileInfo.innerHTML = `
                <strong>ğŸ“ ${selectedFile.name}</strong><br>
                Ø§Ù„Ø­Ø¬Ù…: ${fileSizeMB} MB | Ø§Ù„Ù†ÙˆØ¹: ${selectedFile.type}
            `;
        }
    }
    
    // Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
    async function uploadFile() {
        if (!selectedFile) {
            showResult('error', 'âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const letter = document.getElementById('letter').value;
        const fileName = document.getElementById('fileName').value;
        
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
        uploadBtn.disabled = true;
        uploadBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ FormData
        const formData = new FormData();
        formData.append('audioFile', selectedFile);
        formData.append('letter', letter);
        formData.append('fileName', fileName);
        
        // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
        const urls = [
            `http://localhost:${currentPort}/upload_fixed.php`,
            `http://localhost:${currentPort}/upload.php`,
            `http://127.0.0.1:${currentPort}/upload_fixed.php`,
            `upload_fixed.php`,
            `upload.php`
        ];
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹
        const result = await tryUpload(urls, formData);
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø±
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ğŸš€';
        
        if (result.success) {
            showResult('success', `
                âœ… ${result.message}<br><br>
                <strong>ØªÙØ§ØµÙŠÙ„:</strong><br>
                ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${result.file_name}<br>
                ğŸ’¾ Ø§Ù„Ø­Ø¬Ù…: ${result.file_size}<br>
                ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${result.upload_time}<br>
                ${result.file_path ? `ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø±: ${result.file_path}<br>` : ''}
                <small style="color: #666;">ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° ${currentPort}</small>
            `);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            fileInput.value = '';
            fileInfo.style.display = 'none';
            selectedFile = null;
        } else {
            showResult('error', `
                âŒ ${result.message}<br><br>
                <small>ØªØ£ÙƒØ¯ Ù…Ù†:<br>
                1. ØªØ´ØºÙŠÙ„ Ø³ÙŠØ±ÙØ± PHP Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° ${currentPort}<br>
                2. Ù…Ù„Ù upload.php Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµØ­ÙŠØ­<br>
                3. ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø¬Ù„Ø¯ sounds/</small>
            `);
        }
    }
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
    async function tryUpload(urls, formData) {
        for (const url of urls) {
            try {
                console.log(`Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰: ${url}`);
                
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', data);
                    
                    if (data.success) {
                        return {
                            success: true,
                            ...data
                        };
                    } else {
                        // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ
                        continue;
                    }
                }
            } catch (error) {
                console.log(`ÙØ´Ù„ ${url}:`, error.message);
                // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            }
        }
        
        return {
            success: false,
            message: 'ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø±ÙØ¹'
        };
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    function showResult(type, message) {
        resultDiv.className = `result ${type}`;
        resultDiv.innerHTML = message;
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    window.onload = function() {
        testConnection();
    };
    </script>
</body>
</html>